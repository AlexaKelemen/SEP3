@page "/ShoppingCart"
@using Entities
<h3>Shopping Cart</h3>
@if (CartItems.Count == 0)
{
    <p>Your shopping cart is empty.</p>
}
else
{
    @foreach (var entry in CartItems)
    {
        var item = entry.Value.Item;
        var quantity = entry.Value.Quantity;

@code {


    private Dictionary<int, (Item Item, int Quantity)> CartItems = new Dictionary<int, (Item, int)>();

    private decimal CartTotal => (decimal)CartItems.Sum(entry => entry.Value.Item.Price * entry.Value.Quantity);

    private void AddToCart(Item product, int quantity)
    {
        if (CartItems.ContainsKey(product.ItemId))
        {
            CartItems[product.ItemId] = (product, CartItems[product.ItemId].Quantity + quantity);
        }
        else
        {
            CartItems[product.ItemId] = (product, quantity);
        }
    }


    private void UpdateQuantity(int id, int quantity)
    {
        if (CartItems.ContainsKey(id) && quantity > 0)
        {
            CartItems[id] = (CartItems[id].Item, quantity);
        }
    }

    private void RemoveFromCart(int itemId)
    {
        if (CartItems.ContainsKey(itemId))
        {
            CartItems.Remove(itemId);
        }
    }


    private void Checkout()
    {
        CartItems.Clear();
        StateHasChanged();
    }

}
}
}